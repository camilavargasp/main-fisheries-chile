---
title: 'Scope 1: Fisheries Context'
author: "Camila Vargas e Ignacia Rivera"
date: "August 16, 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(here)
library(magrittr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(readr)
```

## Introduction

The goal of this scope is to combine the data and information gathered from different sources to identify the top domestic fisheries contributing to the landings and national economy of Chile. The following script provides all the methods, information and data that is use to persue this goal. The script is separated in sections that refer to two differen obectives, the first assesing the contribution of different species to volume of landings and the second assesing value of landings. Sections are also based on the sources of data being used. 

## Main sources of information

We will identify the main domestic fisheries regarding volume and value using three different main data sources SERNAPESCA, Sea around us project and FAO estimates. 

## Requested outputs

1) A list of the top 10 domestic marine fisheries in terms of landed volume
2) A list of the top 10 domestic marine fisheries in terms of economic value
3) A clean database used to generate (1)
4) A database used to generate (4)

## Resolution

Where possible, these data should also be broken down by gear type.

## 1) Top domestic marine, capture fisheries based on landed volume

### Using data from SERNAPESCA

```{r importing clean landings SERNAPESCA per species, subsector, month and region}

landings_reg<- read_csv(here("clean_databases/landings_SERNAPESCA.csv")) %>% 
  filter(region != "national") %>% 
  mutate( tons = as.numeric(tons))

```

Adding landings across all regions to determine the top 5 fisheries based on volume per sector nationwide.

```{r}

## General
landing_reg_general <- landings_reg %>%
  group_by(year, species, subsector) %>% 
  summarise(tons = sum(tons, na.rm = T)) %>% 
  data.frame()

## Artisanal

top5_catch_art_per_year <- landing_reg_general  %>%
  filter(subsector== 'artisanal') %>% 
  arrange(year, desc(tons)) %>% 
  group_by(year) %>% 
  top_n(5, tons) %>% 
  data.frame()

## Industrial -- Including fabric vessels. 

top5_catch_ind_per_year <- landing_reg_general  %>%
  filter(subsector %in% c('industrial', 'fabric_vessel')) %>% 
  group_by(species, year) %>% 
  summarise(tons = sum(tons)) %>% 
  arrange(year, desc(tons)) %>% 
  group_by(year) %>% 
  top_n(5, tons) %>% 
  data.frame()

```


```{r plotting top fisheries per sector per year }

## Plot 

main_catch_art <- 
  ggplot(data = top5_catch_art_per_year, aes(x = year, y = tons, fill = species)) + 
    geom_bar(stat= "identity")+
    scale_y_continuous(expand = c(0, 0)) +
    labs(y="Landings (Tons)", x="Year")+
    theme_bw()+
    theme(axis.line = element_line(colour = "black"),
        axis.text=element_text(size=11),
        axis.title=element_text(size=12,face="bold"))

# I am not including 2014 for now because we are missing one database for industrial landings for 2014 (landings per species and region in national waters)

main_catch_ind <- 
  ggplot(data = filter(top5_catch_ind_per_year, year != 2014), aes(x = year, y = tons, fill = species)) + 
    geom_bar(stat= "identity")+
    scale_y_continuous(expand = c(0, 0)) +
    labs(y="Landings (Tons)", x="Year")+
    theme_bw()+
    theme(axis.line = element_line(colour = "black"),
        axis.text=element_text(size=11),
        axis.title=element_text(size=12,face="bold"))

```


