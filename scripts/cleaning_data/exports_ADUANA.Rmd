---
title: "exports_ADUANA"
author: "Camila Vargas e Ignacia Rivera"
date: "2 de noviembre de 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This document cleans the Aduana dataset maatching species with the aduana code from XXXX


Data was downloaded from XXX on October 8 2018.

Here the [link](http://www.aduana.cl/aduana/site/artic/20080218/pags/20080218165942.html#vtxt_cuerpo_T47) witht the details of the codes use in the esports datasets

## Setup
```{r}
library(tidyverse)
library(here)
library(readxl)
library(stringr)
```



## Import aduana export data

```{r}
## read in data for 2010 as an exmple

exports_2010 <- read_delim(here("information/raw_databases/ADUANAS_CHILE/exports/exports_2010.csv"), ";", escape_double = FALSE, trim_ws = TRUE) %>% 
  select(year= PERIODO, month = MES, region = COD_REGION_ORIGEN, destination = COD_PAIS_DESTINO, item_sa =ITEM_SA, fob = FOB_US_DUSLEG, fub = FUB_US_IVV, kg = PESO_BRUTO_KG, quantity = CANTIDAD_MERCANCIA, unit = COD_UNIDAD_MEDIDA)


##Loop to import all data sets from 2010 to 2018

## Save the initial "clean raw data"

```

## Data of our interest

```{r}

##sumarise data to get values per year
exports_yr <- exports_2010 %>% 
  select(- month, -region, - destination, - quantity, -unit, - fub) %>% 
  mutate(value_fob= as.numeric(fob)) %>% 
  mutate(kg= as.numeric(sub(",", ".", kg, fixed = TRUE)))%>% 
  group_by(year, item_sa) %>% 
  summarise(value_fob = mean(fob, na.rm = T),
            tons = mean(kg, na.rm = T)/1000)

```

## match with species SERNAPESCA data base

```{r}
## importa data set

cod_aduana_sp <- read_excel(here("information/raw_databases/ADUANAS_CHILE/arancel_aduanero_nomenclatura/arancel_aduanero_2017/codigos_aduana_por_especie_2017.xlsx"), sheet = "Hoja1", range = "A1:G573") %>%  ##cambiar rango cuando base de datos este completa
mutate(item_sa = gsub("[.]","",codigo_aduana))


##eliminar espacio previo a la especie
##hay alguna forma e leer acentos??

```

```{r}
## primer intento de match

match_2010 <- exports_yr %>% 
  left_join(cod_aduana_sp, by = "item_sa") %>% 
  filter(!is.na(especie_SERNAPESCA))


```






