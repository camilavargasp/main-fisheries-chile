---
title: "Cleaning landings data SERNAPESCA"
author: "Ignacia Rivera"
date: "August 17, 2018"
output: pdf_document
---
This script uses raw data of landings from SERNAPESCA to generate two databases:

1) **mean_landings_SERNAPESCA_month**: contains the mean tons per species per subsector and month aggregated at the national level. The mean was calculated across 2014-2016.

2) **mean_landings_SERNAPESCA_region**: contains the mean tons per species per subsector and month aggregated at the anual level. The mean was calculated across 2014-2016.

Although, SERNAPESCA counts with databases at a higher spatial resolution (ports), this databases cannot be matched with the specific contribution of each subsector. 

## Setup

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(here) #install.packages('here')
library(magrittr) #install.packages('magrittr')
library(dplyr) #install.packages('dplyr')
library(tidyr) #install.packages('tidyr')
library(readxl) #install.packages('readxl')


```

## Importing and formating raw artisanal landings 2014, 2015, 2016, 2017

Datasets are from SERNAPESCA/ Informes y Datos/ Estadisticas/ Pesca Artesanal. 

**Data downloaded** August 15, 2018 (data years 2014-2016), September 24, 2018 (data 2017)

**Data range** 2014 -2017

We need still need to know: 

1) if - in SERNAPESCA databases means 0 or NA. Probably 0.  
2) if landings in international waters means that fisher are fishing in international waters or that they are landing in international waters. 

Ignacia is waiting for an answer from SERNAPESCA under the request 460245718

```{r importing artisanal landings data for 2014, 2015, 2016 per species, subsector, month and region}

## Artisanal landings per month

artisanal_month_2014 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_artisanal_per_species_month_2014.xls"), sheet = "des_art_mes", range = "A5:M147", na = "-") %>% 
  gather(key = month, value = tons, 2:13)%>% 
  mutate (subsector = 'artisanal', year = 2014, region = 'national', species =  ESPECIE, international_waters = 0) %>% 
  select(subsector, year, region, month, species, tons, international_waters)


artisanal_month_2015 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_artisanal_per_species_month_2015.xls"), sheet = "des_art_mes", range = "A5:M150", na = "-")%>% 
  gather(key = month, value = tons, 2:13)%>% 
  mutate (subsector = 'artisanal', year = 2015, region = 'national', species =  ESPECIE, international_waters = 0) %>% 
  select(subsector, year, region, month, species, tons, international_waters)

artisanal_month_2016 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_artisanal_per_species_month_2016.xls"), sheet = "des_art_mes", range = "A5:M147", na = "-")%>% 
  gather(key = month, value = tons, 2:13)%>% 
  mutate (subsector = 'artisanal', year = 2016, region = 'national', species =  ESPECIE, international_waters = 0) %>% 
  select(subsector, year, region, month, species, tons, international_waters)

artisanal_month_2017 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_artisanal_per_species_month_2017.xlsx"), sheet = "des_art_mes", range = "A5:M147", na = "-")%>% 
  gather(key = month, value = tons, 2:13)%>% 
  mutate (subsector = 'artisanal', year = 2017, region = 'national', species =  ESPECIE, international_waters = 0) %>% 
  select(subsector, year, region, month, species, tons, international_waters)

## Artisanal landings per region

artisanal_region_2014 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_artisanal_per_species_region_2014.xls"), sheet = "des_art_region", range = "A5:O153", na = "-") %>% 
  gather(key = region, value = tons, 2:15) %>% 
  mutate (subsector = 'artisanal', year = 2014, month = 'anual', species =  ESPECIE, international_waters = 0)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

artisanal_region_2015 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_artisanal_per_species_region_2015.xls"), sheet = "des_art_region", range = "A5:O150", na = "-")%>% 
  gather(key = region, value = tons, 2:15)%>% 
  mutate (subsector = 'artisanal', year = 2015, month = 'anual', species =  ESPECIE, international_waters = 0)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

artisanal_region_2016 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_artisanal_per_species_region_2016.xls"), sheet = "des_art_region", range = "A5:O147", na = "-")%>% 
  gather(key = region, value = tons, 2:15)%>% 
  mutate (subsector = 'artisanal', year = 2016, month = 'anual', species =  ESPECIE, international_waters = 0)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

artisanal_region_2017 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_artisanal_per_species_region_2017.xlsx"), sheet = "des_art_region", range = "A5:O147", na = "-")%>% 
  gather(key = region, value = tons, 2:15)%>% 
  mutate (subsector = 'artisanal', year = 2017, month = 'anual', species =  ESPECIE, international_waters = 0)%>% 
  select(subsector, year, region, month, species, tons, international_waters)


## Artisanal landings international waters per month

artisanal_iw_month_2014 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_artisanal_international_waters_per_species_region_month_2014.xls"), sheet = "des_art_ai_mes", range = "A5:M11", na = "-") %>% 
  gather(key = month, value = tons,2:13) %>% 
  mutate (subsector = 'artisanal', year = 2014, region = 'national', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

artisanal_iw_month_2015 <-read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_artisanal_international_waters_per_species_region_month_2015.xls"), sheet = "des_art_ai_mes", range = "A5:M9", na = "-") %>% 
  gather(key = month, value = tons,2:13) %>% 
  mutate (subsector = 'artisanal', year = 2015, region = 'national', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

artisanal_iw_month_2016 <-read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_artisanal_international_waters_per_species_region_month_2016.xls"), sheet = "des_art_ai_mes", range = "A5:M8", na = "-") %>% 
  gather(key = month, value = tons,2:13) %>% 
  mutate (subsector = 'artisanal', year = 2016, region = 'national', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

artisanal_iw_month_2017 <-read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_artisanal_international_waters_per_species_region_month_2017.xlsx"), sheet = "des_art_ai_mes", range = "A5:M8", na = "-") %>% 
  gather(key = month, value = tons,2:13) %>% 
  mutate (subsector = 'artisanal', year = 2017, region = 'national', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)


## Artisanal landings international waters per region

artisanal_iw_region_2014 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_artisanal_international_waters_per_species_region_month_2014.xls"), sheet = "des_art_ai_reg", range = "A5:O11", na = "-")%>% 
  gather(key = region, value = tons,2:15) %>% 
  mutate (subsector = 'artisanal', year = 2014, month = 'anual', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

artisanal_iw_region_2015 <-read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_artisanal_international_waters_per_species_region_month_2015.xls"), sheet = "des_art_ai_region", range = "A5:P9", na = "-")%>% 
  gather(key = region, value = tons,2:16) %>% 
  mutate (subsector = 'artisanal', year = 2015, month = 'anual', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

artisanal_iw_region_2016 <-read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_artisanal_international_waters_per_species_region_month_2016.xls"), sheet = "des_art_ai_region", range = "A5:P8", na = "-")%>% 
  gather(key = region, value = tons,2:16) %>% 
  mutate (subsector = 'artisanal', year = 2016, month = 'anual', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

artisanal_iw_region_2017 <-read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_artisanal_international_waters_per_species_region_month_2017.xlsx"), sheet = "des_art_ai_region", range = "A5:P8", na = "-")%>% 
  gather(key = region, value = tons,2:16) %>% 
  mutate (subsector = 'artisanal', year = 2017, month = 'anual', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)


```



## Importing and formating raw industrial landings 2014, 2015, 2016, 2017. 


Datasets are from SERNAPESCA/ Informes y Datos/ Estadisticas/ Pesca Industrial. Accessed August 15, 2018. Data for 2014 and 2017 was not available online but was requested to SERNAPESCA. 
Data for 2017 was downloaded September 24, 2018

**We need still need to know**

1) if - in SERNAPESCA databases means 0 or NA. Probably 0.  
2) if landings from industrials include fabric vessels. Probably not. 
3) if landings in international waters means that fisher are fishing in international waters or that they are landing in international waters. 

Ignacia is waiting for an answer from SERNAPESCA under the request 460245718


```{r importing industrial landings data for 2014, 2015, 2016 per species, subsector, month and region} 
# Industrial landings per month

industrial_month_2014 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_industrial_per_species_month_2014.xls"), sheet = "des_ind_mes", range = "A5:M52", na = "-") %>% 
  gather(key = month, value = tons, 2:13)%>% 
  mutate (subsector = 'industrial', year = 2014, region = 'national', species =  ESPECIE, international_waters = 0) %>% 
  select(subsector, year, region, month, species, tons, international_waters)

industrial_month_2015 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_industrial_per_species_month_2015.xls"), sheet = "des_ind_mes", range = "A5:M52", na = "-") %>% 
  gather(key = month, value = tons, 2:13)%>% 
  mutate (subsector = 'industrial', year = 2015, region = 'national', species =  ESPECIE, international_waters = 0) %>% 
  select(subsector, year, region, month, species, tons, international_waters)

industrial_month_2016 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_industrial_per_species_month_2016.xls"), sheet = "des_ind_mes", range = "A5:M48", na = "-") %>% 
  gather(key = month, value = tons, 2:13)%>% 
  mutate (subsector = 'industrial', year = 2016, region = 'national', species =  ESPECIE, international_waters = 0) %>% 
  select(subsector, year, region, month, species, tons, international_waters)

industrial_month_2017 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_industrial_per_species_month_2017.xlsx"), sheet = "des_ind_mes", range = "A5:M48", na = "-") %>% 
  gather(key = month, value = tons, 2:13)%>% 
  mutate (subsector = 'industrial', year = 2017, region = 'national', species =  ESPECIE, international_waters = 0) %>% 
  select(subsector, year, region, month, species, tons, international_waters)

## Industrial landings per region (missing for 2014)

industrial_region_2015 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_industrial_per_species_region_2015.xls"), sheet = "Des_ind_region", range = "A5:O52", na = "-")%>% 
  gather(key = region, value = tons, 2:15)%>% 
  mutate (subsector = 'industrial', year = 2015, month = 'anual', species =  ESPECIE, international_waters = 0)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

industrial_region_2016 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_industrial_per_species_region_2016.xls"), sheet = "Des_ind_region", range = "A5:O48", na = "-")%>% 
  gather(key = region, value = tons, 2:15)%>% 
  mutate (subsector = 'industrial', year = 2016, month = 'anual', species =  ESPECIE, international_waters = 0)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

industrial_region_2017 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_industrial_per_species_region_2017.xls"), sheet = "Des_ind_region", range = "A5:O48", na = "-")%>% 
  gather(key = region, value = tons, 2:15)%>% 
  mutate (subsector = 'industrial', year = 2017, month = 'anual', species =  ESPECIE, international_waters = 0)%>% 
  select(subsector, year, region, month, species, tons, international_waters)


## Industrial landings international waters per month

industrial_iw_month_2014 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_industrial_international_waters_per_species_region_month_2014.xls"), sheet = "industriales_ai_mes", range = "A5:M13", na = "-") %>% 
  gather(key = month, value = tons,2:13) %>% 
  mutate (subsector = 'industrial', year = 2014, region = 'national', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

industrial_iw_month_2015 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_industrial_international_waters_per_species_region_month_2015.xls"), sheet = "ind_ai_mes", range = "A5:M12", na = "-") %>% 
  gather(key = month, value = tons,2:13) %>% 
  mutate (subsector = 'industrial', year = 2015, region = 'national', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

industrial_iw_month_2016 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_industrial_international_waters_per_species_region_month_2016.xls"), sheet = "ind_ai_mes", range = "A5:M13", na = "-") %>% 
  gather(key = month, value = tons,2:13) %>% 
  mutate (subsector = 'industrial', year = 2016, region = 'national', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)


industrial_iw_month_2017 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_industrial_international_waters_per_species_region_month_2017.xlsx"), sheet = "ind_ai_mes", range = "A5:M13", na = "-") %>% 
  gather(key = month, value = tons,2:13) %>% 
  mutate (subsector = 'industrial', year = 2017, region = 'national', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)



## Industrial landings international waters per region

industrial_iw_region_2014 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_industrial_international_waters_per_species_region_month_2014.xls"), sheet = "industriales_ai_region", range = "A5:O13", na = "-")%>% 
  gather(key = region, value = tons,2:15) %>% 
  mutate (subsector = 'industrial', year = 2014, month = 'anual', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

industrial_iw_region_2015 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_industrial_international_waters_per_species_region_month_2015.xls"), sheet = "ind_ai_region", range = "A5:O12", na = "-")%>% 
  gather(key = region, value = tons,2:15) %>% 
  mutate (subsector = 'industrial', year = 2015, month = 'anual', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

industrial_iw_region_2016 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_industrial_international_waters_per_species_region_month_2016.xls"), sheet = "ind_ai_region", range = "A5:O13", na = "-")%>% 
  gather(key = region, value = tons,2:15) %>% 
  mutate (subsector = 'industrial', year = 2016, month = 'anual', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

industrial_iw_region_2017 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_industrial_international_waters_per_species_region_month_2017.xlsx"), sheet = "ind_ai_region", range = "A5:O13", na = "-")%>% 
  gather(key = region, value = tons,2:15) %>% 
  mutate (subsector = 'industrial', year = 2017, month = 'anual', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

```



## Importing and formating raw landings from fabric vessels 2014, 2015, 2016, 2017. 


Datasets are from SERNAPESCA/ Informes y Datos/ Estadisticas/ Pesca Industrial. Accessed August 15, 2018 (for data from 2014-16) and on September 24, 2018 for 2017 data.

**We need still need to know**

1) if - in SERNAPESCA databases means 0 or NA. Probably 0.  
2) if landings from industrials include fabric vessels. Probably not. 
3) if landings in international waters means that fisher are fishing in international waters or  that they are landing in international waters. 

Ignacia is waiting for an answer from SERNAPESCA under the request 460245718


```{r importing and formating raw landings from fabric vessels 2014, 2015, 2016}
## Landings from fabric vessels (fv) per month

fv_month_2014 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_fabric_vessels_per_species_region_month_2014.xls"), sheet = "des_bf_nac_mes", range = "A5:M19", na = "-") %>% 
  gather(key = month, value = tons, 2:13)%>% 
  mutate (subsector = 'fabric_vessel', year = 2014, region = 'national', species =  ESPECIE, international_waters = 0) %>% 
  select(subsector, year, region, month, species, tons, international_waters)

fv_month_2015 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_fabric_vessels_per_species_region_month_2015.xls"), sheet = "bf_nac_mes", range = "A5:M20", na = "-") %>% 
  gather(key = month, value = tons, 2:13)%>% 
  mutate (subsector = 'fabric_vessel', year = 2015, region = 'national', species =  ESPECIE, international_waters = 0) %>% 
  select(subsector, year, region, month, species, tons, international_waters)


fv_month_2016 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_fabric_vessels_per_species_region_month_2016.xls"), sheet = "bf_nac_mes", range = "A5:M21", na = "-") %>% 
  gather(key = month, value = tons, 2:13)%>% 
  mutate (subsector = 'fabric_vessel', year = 2016, region = 'national', species =  ESPECIE, international_waters = 0) %>% 
  select(subsector, year, region, month, species, tons, international_waters)


fv_month_2017 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_fabric_vessels_per_species_region_month_2017.xlsx"), sheet = "bf_nac_mes", range = "A5:M21", na = "-") %>% 
  gather(key = month, value = tons, 2:13)%>% 
  mutate (subsector = 'fabric_vessel', year = 2017, region = 'national', species =  ESPECIE, international_waters = 0) %>% 
  select(subsector, year, region, month, species, tons, international_waters)


## Landings from fabric vessels (fv) per region

fv_region_2014 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_fabric_vessels_per_species_region_month_2014.xls"), sheet = "des_bf_nac_reg", range = "A5:O19", na = "-") %>% 
  gather(key = region, value = tons, 2:15)%>% 
  mutate (subsector = 'fabric_vessel', year = 2014, month = 'anual', species =  ESPECIE, international_waters = 0) %>% 
  select(subsector, year, region, month, species, tons, international_waters)

fv_region_2015 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_fabric_vessels_per_species_region_month_2015.xls"), sheet = "bf_nac_region", range = "A5:O20", na = "-") %>% 
  gather(key = region, value = tons, 2:15)%>% 
  mutate (subsector = 'fabric_vessel', year = 2015, month = 'anual', species =  ESPECIE, international_waters = 0) %>% 
  select(subsector, year, region, month, species, tons, international_waters)


fv_region_2016 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_fabric_vessels_per_species_region_month_2016.xls"), sheet = "bf_nac_region", range = "A5:O21", na = "-") %>% 
  gather(key = region, value = tons, 2:15)%>% 
  mutate (subsector = 'fabric_vessel', year = 2016, month = 'anual', species =  ESPECIE, international_waters = 0) %>% 
  select(subsector, year, region, month, species, tons, international_waters)


fv_region_2017 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_fabric_vessels_per_species_region_month_2017.xlsx"), sheet = "bf_nac_region", range = "A5:O21", na = "-") %>% 
  gather(key = region, value = tons, 2:15)%>% 
  mutate (subsector = 'fabric_vessel', year = 2017, month = 'anual', species =  ESPECIE, international_waters = 0) %>% 
  select(subsector, year, region, month, species, tons, international_waters)


## Landings from fabric vessels (fv) in international waters per month

fv_iw_month_2014 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_fabric_vessels_international_waters_per_species_region_month_2014.xls"), sheet = "bf_ai_mes", range = "A5:M13", na = "-")%>%   gather(key = month, value = tons,2:13) %>% 
  mutate (subsector = 'fabric_vessel', year = 2014, region = 'national', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

fv_iw_month_2015 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_fabric_vessels_international_waters_per_species_region_month_2015.xls"), sheet = "bf_ai_mes", range = "A5:M11", na = "-")%>%   gather(key = month, value = tons,2:13) %>% 
  mutate (subsector = 'fabric_vessel', year = 2015, region = 'national', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

fv_iw_month_2016 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_fabric_vessels_international_waters_per_species_region_month_2016.xls"), sheet = "bf_ai_mes", range = "A5:M23", na = "-") %>% 
  gather(key = month, value = tons,2:13) %>% 
  mutate (subsector = 'fabric_vessel', year = 2016, region = 'national', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

fv_iw_month_2017 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_fabric_vessels_international_waters_per_species_region_month_2017.xlsx"), sheet = "bf_ai_mes", range = "A5:M23", na = "-") %>% 
  gather(key = month, value = tons,2:13) %>% 
  mutate (subsector = 'fabric_vessel', year = 2017, region = 'national', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)


## Fabric vessels landings international waters per region

fv_iw_region_2014 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_fabric_vessels_international_waters_per_species_region_month_2014.xls"), sheet = "bf_ai_reg", range = "A5:O13", na = "-")%>% 
  gather(key = region, value = tons,2:15) %>% 
  mutate (subsector = 'fabric_vessel', year = 2014, month = 'anual', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

fv_iw_region_2015 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_fabric_vessels_international_waters_per_species_region_month_2015.xls"), sheet = "bf_ai_region", range = "A5:O11", na = "-")%>% 
  gather(key = region, value = tons,2:15) %>% 
  mutate (subsector = 'fabric_vessel', year = 2015, month = 'anual', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)

fv_iw_region_2016 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_fabric_vessels_international_waters_per_species_region_month_2016.xls"), sheet = "bf_ai_region", range = "A5:P23", na = "-")%>% 
  gather(key = region, value = tons,2:16) %>% 
  mutate (subsector = 'fabric_vessel', year = 2016, month = 'anual', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)


fv_iw_region_2017 <- read_excel(here("information/raw_databases/SERNAPESCA/landings/landings_fabric_vessels_international_waters_per_species_region_month_2017.xlsx"), sheet = "bf_ai_region", range = "A5:P23", na = "-")%>% 
  gather(key = region, value = tons,2:16) %>% 
  mutate (subsector = 'fabric_vessel', year = 2017, month = 'anual', species =  ESPECIE, international_waters = 1)%>% 
  select(subsector, year, region, month, species, tons, international_waters)


```


## Combining all landings data for 2014, 2015, 2016. 


```{r}

landings_SERNAPESCA <- rbind(artisanal_month_2014, artisanal_month_2015, artisanal_month_2016, artisanal_month_2017, artisanal_region_2014, artisanal_region_2015, artisanal_region_2015, artisanal_region_2016, artisanal_region_2017, artisanal_iw_month_2014, artisanal_iw_month_2015, artisanal_iw_month_2016, artisanal_iw_month_2017, artisanal_iw_region_2014,artisanal_iw_region_2015, artisanal_iw_region_2016, artisanal_iw_region_2017, industrial_month_2014, industrial_month_2015, industrial_month_2016, industrial_month_2017, industrial_region_2015, industrial_region_2016, industrial_region_2017, industrial_iw_month_2014, industrial_iw_month_2015, industrial_iw_month_2016, industrial_iw_month_2017, industrial_iw_region_2014, industrial_iw_region_2015, industrial_iw_region_2016, industrial_iw_region_2017, fv_month_2014, fv_month_2015, fv_month_2016, fv_month_2017, fv_region_2014, fv_region_2015, fv_region_2016, fv_region_2017, fv_iw_month_2014, fv_iw_month_2015, fv_iw_month_2016, fv_iw_month_2017, fv_iw_region_2014, fv_iw_region_2015, fv_iw_region_2016, fv_iw_region_2017) %>% 
  filter(!(species =='NA'))

```

## Wrangling and saving clean csv

Generating landings_SERNAPESCA_month.csv

```{r creating landings_SERNAPESCA_month}

##calculates mean landing per species, subsector, waters and month (national level)

mean_landings_SERNAPESCA_month <- landings_SERNAPESCA %>% 
  filter(region == 'national') %>%  # removing anual estimates per region
  group_by(subsector, species, month, international_waters) %>% 
    summarise(tons = mean(tons, na.rm = TRUE))

## Writes cleaned database to clean_databases

write.csv(mean_landings_SERNAPESCA_month,  here("clean_databases/mean_landings_SERNAPESCA_month.csv"), row.names=T)

```

Generating landings_SERNAPESCA_region.csv

```{r creating landings_SERNAPESCA_region}

## calculates mean landing per species, subsector, waters and region

mean_landings_SERNAPESCA_region <- landings_SERNAPESCA %>% 
  filter(month == 'anual') %>%  # removing national estimates per month
  group_by(subsector, species, region, international_waters) %>% 
    summarise(tons = mean(tons, na.rm = TRUE))

# Writes cleaned database to clean_databases

write.csv(mean_landings_SERNAPESCA_region,  here("clean_databases/mean_landings_SERNAPESCA_region.csv"), row.names=T)

```
